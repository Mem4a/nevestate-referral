<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Nevestate Partner</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* --- –ë–ê–ó–û–í–´–ï –ù–ê–°–¢–†–û–ô–ö–ò --- */
        :root {
            --primary-gold: #bba589;
            --bg-color: #ffffff;
            --text-color: #333333;
            --input-bg: #eeeeee;
            --error-color: #ff3b30;
        }

        body { 
            font-family: 'Helvetica Neue', Arial, sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            margin: 0; padding: 0; box-sizing: border-box; 
            min-height: 100vh;
        }

        .hidden { display: none !important; }

        /* --- –≠–ö–†–ê–ù–´ --- */
        .app-screen {
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-sizing: border-box;
            animation: fadeIn 0.3s ease-in-out;
            padding-bottom: 100px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ TG */
        }

        /* --- –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò & –î–û–°–¢–£–ü –ó–ê–ü–†–ï–©–ï–ù --- */
        #loaderScreen, #accessDeniedScreen { 
            justify-content: center; 
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh; 
            z-index: 999; background: #fff; text-align: center;
        }
        #accessDeniedScreen h2 { color: var(--error-color); font-family: 'Georgia', serif;}

        /* --- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ --- */
        #mainMenuScreen { justify-content: center; text-align: center; height: 100vh; }

        .logo-area {
            width: 120px; height: 120px; background-color: #f5f5f5; border-radius: 50%;
            margin-bottom: 20px; display: flex; align-items: center; justify-content: center;
            font-size: 40px; color: var(--primary-gold); border: 2px solid var(--primary-gold);
            overflow: hidden;
        }

        .app-title { font-family: 'Georgia', serif; font-size: 24px; margin-bottom: 10px; color: #000; }
        .app-subtitle { font-size: 14px; color: #777; margin-bottom: 30px; max-width: 300px; line-height: 1.5; }

        .menu-btn {
            width: 100%; max-width: 300px; padding: 16px; margin-bottom: 12px;
            border-radius: 100px; border: none; font-size: 15px; font-weight: 600;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary { background-color: var(--primary-gold); color: #fff; text-transform: uppercase; font-family: 'Georgia', serif; }
        .btn-secondary { background-color: var(--input-bg); color: #333; }
        .btn-hr { background-color: #333; color: #fff; }

        /* --- –§–û–†–ú–´ --- */
        .my-form-container { width: 100%; max-width: 380px; text-align: left; }
        h3.form-title { font-family: 'Georgia', serif; text-align: center; margin-bottom: 25px; font-size: 22px; color: #000; }
        .form-label { margin-left: 15px; margin-bottom: 5px; font-size: 13px; color: #999; display: block; margin-top: 15px;}
        
        .my-form-container input, .my-form-container select, .my-form-container textarea {
            width: 100%; padding: 15px 25px; border-radius: 30px; border: none; 
            background-color: var(--input-bg); color: #333; font-size: 16px; 
            box-sizing: border-box; margin-bottom: 5px; outline: none; appearance: none;
        }
        .my-form-container input[type="date"] { appearance: auto; }
        .my-form-container textarea { border-radius: 20px; min-height: 100px; resize: vertical; }
        .my-form-container input:focus, .my-form-container select:focus, .my-form-container textarea:focus { box-shadow: 0 0 0 2px var(--primary-gold); background-color: #fff; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="loaderScreen" class="app-screen">
        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 38 38" stroke="#bba589">
            <g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" stroke-width="2"><circle stroke-opacity=".5" cx="18" cy="18" r="18"/><path d="M36 18c0-9.94-8.06-18-18-18"><animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"/></path></g></g>
        </svg>
    </div>

    <div id="accessDeniedScreen" class="app-screen hidden">
        <div style="margin-top: 40vh;">
            <h2>–î–æ—Å—Ç—É–ø –∑–∞–∫—Ä—ã—Ç</h2>
            <p style="color: #777;">–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ Nevestate.</p>
        </div>
    </div>

    <div id="mainMenuScreen" class="app-screen hidden">
        <div class="logo-area"><span>N</span></div>
        <h1 class="app-title">NEVESTATE PORTAL</h1>
        <p class="app-subtitle">–ï–¥–∏–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–¥–µ–ª–∫–∞–º–∏ –∏ –∫–æ–º–∞–Ω–¥–æ–π.</p>

        <button class="menu-btn btn-primary" onclick="openScreen('referralFormScreen')">
            + –ü–µ—Ä–µ–¥–∞—Ç—å –ª–∏–¥
        </button>
        
        <button class="menu-btn btn-secondary" onclick="openScreen('hrRequestScreen')">
            üë§ –ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–¥–±–æ—Ä
        </button>

        <button class="menu-btn btn-secondary" onclick="openScreen('onboardingRequestScreen')">
            üöÄ –ó–∞—è–≤–∫–∞ –Ω–∞ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥
        </button>

        <button id="hrCabinetBtn" class="menu-btn btn-hr hidden" onclick="openScreen('hrCabinetScreen')">
            ‚öôÔ∏è –ö–∞–±–∏–Ω–µ—Ç HR
        </button>
    </div>

    <div id="referralFormScreen" class="app-screen hidden">
        <div class="my-form-container">
            <h3 class="form-title">–ü–µ—Ä–µ–¥–∞—á–∞ –∫–ª–∏–µ–Ω—Ç–∞</h3>
            <label class="form-label">–°—Ç—Ä–∞–Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–∞</label>
            <select id="countrySelect" onchange="filterBrokers()"><option value="" selected>–ó–∞–≥—Ä—É–∑–∫–∞...</option></select>
            <label class="form-label">–ü—Ä–∏–Ω–∏–º–∞—é—â–∏–π –±—Ä–æ–∫–µ—Ä</label>
            <select id="brokerSelect"><option value="" disabled selected>–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option></select>
            <label class="form-label">–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
            <input type="text" id="clientName" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
            <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞</label>
            <input type="tel" id="clientPhone" placeholder="+7 999 000-00-00">
            <label class="form-label">–ë—é–¥–∂–µ—Ç ($)</label>
            <input type="text" id="clientBudget" inputmode="decimal" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 250 000">
            <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
            <textarea id="comment" placeholder="–°—Ä–æ–∫–∏, –ø–æ–∂–µ–ª–∞–Ω–∏—è, –Ω—é–∞–Ω—Å—ã..."></textarea>
        </div>
    </div>

    <div id="hrRequestScreen" class="app-screen hidden">
        <div class="my-form-container">
            <h3 class="form-title">–ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–¥–±–æ—Ä</h3>
            
            <label class="form-label">1. –ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏</label>
            <input type="text" id="hr_v_title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ë—Ä–æ–∫–µ—Ä –û–ê–≠">

            <label class="form-label">2. –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ / –û—Ç–¥–µ–ª</label>
            <input type="text" id="hr_v_dept" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂ –î—É–±–∞–π">

            <label class="form-label">3. –ù–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å</label>
            <input type="text" id="hr_v_manager" placeholder="–§–ò–û —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è">

            <label class="form-label">4. –ü—Ä–∏—á–∏–Ω—ã –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–∞–∫–∞–Ω—Å–∏–∏</label>
            <textarea id="hr_v_reason" placeholder="–ù–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞, –∑–∞–º–µ–Ω–∞ —É—à–µ–¥—à–µ–≥–æ (–ø–æ—á–µ–º—É —É—à–µ–ª?), —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ..."></textarea>

            <label class="form-label">5. –ñ–µ–ª–∞–µ–º–∞—è –¥–∞—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∏—è</label>
            <input type="date" id="hr_v_date">

            <label class="form-label">6. –§–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã</label>
            <select id="hr_v_format">
                <option value="–û—Ñ–∏—Å">–û—Ñ–∏—Å</option>
                <option value="–£–¥–∞–ª–µ–Ω–∫–∞">–£–¥–∞–ª—ë–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞</option>
                <option value="–ì–∏–±—Ä–∏–¥">–ì–∏–±—Ä–∏–¥</option>
            </select>

            <label class="form-label">7. –ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∏</label>
            <input type="text" id="hr_v_trips" placeholder="–ù–µ—Ç / –î–∞ (–∫–∞–∫ —á–∞—Å—Ç–æ?)">

            <label class="form-label">8. –§–æ—Ä–º–∞—Ç –∑–∞–Ω—è—Ç–æ—Å—Ç–∏</label>
            <select id="hr_v_employment">
                <option value="–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è, –ø–æ–ª–Ω—ã–π –¥–µ–Ω—å">–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è, –ø–æ–ª–Ω—ã–π –¥–µ–Ω—å</option>
                <option value="–í—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç">–í—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç</option>
                <option value="–ü—Ä–æ–µ–∫—Ç–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å">–ü—Ä–æ–µ–∫—Ç–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å</option>
                <option value="–ß–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å">–ß–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å</option>
            </select>

            <label class="form-label">9. –£—Ä–æ–≤–µ–Ω—å –∑–∞—Ä–ø–ª–∞—Ç—ã</label>
            <input type="text" id="hr_v_salary" placeholder="–§–∏–∫—Å, KPI, % —Å–æ —Å–¥–µ–ª–æ–∫">

            <label class="form-label">10. –û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</label>
            <textarea id="hr_v_duties" placeholder="–ß—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å..."></textarea>

            <label class="form-label">11. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–∞–Ω–¥–∏–¥–∞—Ç—É</label>
            <textarea id="hr_v_reqs" placeholder="–û–ø—ã—Ç, –Ω–∞–≤—ã–∫–∏, —è–∑—ã–∫–∏..."></textarea>

            <label class="form-label">12. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</label>
            <textarea id="hr_v_comments" placeholder="–õ—é–±—ã–µ –¥—Ä—É–≥–∏–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è..."></textarea>
        </div>
    </div>

    <div id="onboardingRequestScreen" class="app-screen hidden">
        <div class="my-form-container">
            <h3 class="form-title">–ó–∞—è–≤–∫–∞ –Ω–∞ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥</h3>
            
            <label class="form-label">1. –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (RU/EN)</label>
            <input type="text" id="onb_name" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω / Ivan Ivanov">

            <label class="form-label">2. –î–æ–ª–∂–Ω–æ—Å—Ç—å –∏ –æ—Ç–¥–µ–ª</label>
            <input type="text" id="onb_position" placeholder="–ë—Ä–æ–∫–µ—Ä, –û—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂">

            <label class="form-label">3. –°—Ç—Ä–∞–Ω–∞ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è</label>
            <input type="text" id="onb_country" placeholder="–û–ê–≠, –ë–∞–ª–∏, –†–æ—Å—Å–∏—è...">

            <label class="form-label">4. –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</label>
            <input type="date" id="onb_start_date">

            <label class="form-label">5. –ö–æ–Ω—Ç–∞–∫—Ç—ã (Email, –¢–µ–ª, TG)</label>
            <textarea id="onb_contacts" placeholder="ivan@gmail.com, +7..., @ivan_tg" style="min-height: 80px;"></textarea>

            <label class="form-label">6. –ú–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã</label>
            <select id="onb_workplace">
                <option value="–û—Ñ–∏—Å">–û—Ñ–∏—Å</option>
                <option value="–£–¥–∞–ª–µ–Ω–∫–∞">–£–¥–∞–ª—ë–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç</option>
                <option value="–ì–∏–±—Ä–∏–¥">–ì–∏–±—Ä–∏–¥</option>
            </select>

            <label class="form-label">7. –¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ —Ä–∞–±–æ—á–∞—è –ø–æ—á—Ç–∞?</label>
            <select id="onb_email_req">
                <option value="–î–∞">–î–∞</option>
                <option value="–ù–µ—Ç">–ù–µ—Ç</option>
            </select>

            <label class="form-label">8. –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è —Å–∏–º-–∫–∞—Ä—Ç–∞ / e-sim?</label>
            <input type="text" id="onb_sim" placeholder="–ù—É–∂–Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è / –ù—É–∂–Ω–∞ e-sim / –ù–µ –Ω—É–∂–Ω–∞">

            <label class="form-label">9. –ù—É–∂–Ω–æ –ª–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ?</label>
            <input type="text" id="onb_equipment" placeholder="–ù–æ—É—Ç–±—É–∫, —Ç–µ–ª–µ—Ñ–æ–Ω –∏ —Ç.–¥.">

            <label class="form-label">10. –û—Ñ–∏—Å–Ω—ã–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏</label>
            <input type="text" id="onb_office_extras" placeholder="–ö–∞–Ω—Ü–µ–ª—è—Ä–∏—è, –º–µ–±–µ–ª—å (–µ—Å–ª–∏ –≤ –æ—Ñ–∏—Å–µ)">

            <label class="form-label">11. –î–æ—Å—Ç—É–ø—ã –∫ Google-–¥–∏—Å–∫—É</label>
            <textarea id="onb_gdrive" placeholder="–ö –∫–∞–∫–∏–º –ø–∞–ø–∫–∞–º –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø..." style="min-height: 80px;"></textarea>

            <label class="form-label">12. –ì—Ä—É–ø–ø—ã WhatsApp</label>
            <textarea id="onb_whatsapp" placeholder="–í –∫–∞–∫–∏–µ —Ä–∞–±–æ—á–∏–µ —á–∞—Ç—ã –¥–æ–±–∞–≤–∏—Ç—å..." style="min-height: 80px;"></textarea>

            <label class="form-label">13. –î—Ä—É–≥–∏–µ –¥–æ—Å—Ç—É–ø—ã (CRM, —Å–µ—Ä–≤–∏—Å—ã)</label>
            <textarea id="onb_other_access" placeholder="amoCRM, Notion, Trello..." style="min-height: 80px;"></textarea>

            <label class="form-label">14. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</label>
            <textarea id="onb_comments" placeholder="–û—Å–æ–±—ã–µ –æ—Ç–º–µ—Ç–∫–∏ –¥–ª—è HR –∏ IT..." style="min-height: 80px;"></textarea>
        </div>
    </div>

    <div id="hrCabinetScreen" class="app-screen hidden">
        <div class="my-form-container" style="text-align: center;">
            <h3 class="form-title">–ö–∞–±–∏–Ω–µ—Ç HR</h3>
            <p style="color: #666; font-size: 15px; margin-top: 50px;">
                –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∫–ª–∏–∫–∞–º–∏ –∏ –≤–∞–∫–∞–Ω—Å–∏—è–º–∏. 
                <br><br>–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ üõ†Ô∏è
            </p>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.setHeaderColor('#ffffff'); tg.setBackgroundColor('#ffffff');

        // --- –ù–ê–°–¢–†–û–ô–ö–ò ---
        const ALLOWED_HR_IDS = [1211686949, 8596402710]; 
        
        // –í–ù–ò–ú–ê–ù–ò–ï: –°–Æ–î–ê –ù–£–ñ–ù–û –î–û–ë–ê–í–ò–¢–¨ ID –í–°–ï–• –°–û–¢–†–£–î–ù–ò–ö–û–í, –ß–¢–û–ë–´ –û–ù–ò –ú–û–ì–õ–ò –í–û–ô–¢–ò
        // –ï—Å–ª–∏ –º–∞—Å—Å–∏–≤ –ø—É—Å—Ç–æ–π [], –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ –±—É–¥–µ—Ç (–ø—É—Å—Ç–∏—Ç –≤—Å–µ—Ö).
        const ALLOWED_EMPLOYEES = []; 

        const GET_URL = 'https://n8n.nevn8n8amocrm.online/webhook/72ab1905-055c-4452-ae15-16245b46693e';
        const POST_REFERRAL_URL = 'https://n8n.nevn8n8amocrm.online/webhook/f2cd4077-afb6-428e-adc0-4357783010a7';
        
        // –í–ï–ë–•–£–ö–ò –î–õ–Ø –ù–û–í–´–• –§–û–†–ú (–°–æ–∑–¥–∞–π –∏—Ö –≤ n8n)
        const POST_HR_VACANCY_URL = 'https://n8n.nevn8n8amocrm.online/webhook/NEW-HR-VACANCY-WEBHOOK'; 
        const POST_ONBOARDING_URL = 'https://n8n.nevn8n8amocrm.online/webhook/NEW-ONBOARDING-WEBHOOK';

        let allBrokers = []; let allCountries = [];
        let currentScreenId = 'loaderScreen';

        // 1. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        async function init() {
            const currentUserId = tg.initDataUnsafe.user?.id;
            
            // –ü–†–û–í–ï–†–ö–ê –î–û–°–¢–£–ü–ê –°–û–¢–†–£–î–ù–ò–ö–ê
            if (ALLOWED_EMPLOYEES.length > 0 && currentUserId && !ALLOWED_EMPLOYEES.includes(currentUserId)) {
                document.getElementById('loaderScreen').classList.add('hidden');
                document.getElementById('accessDeniedScreen').classList.remove('hidden');
                return; // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            }

            if (ALLOWED_HR_IDS.includes(currentUserId)) {
                document.getElementById('hrCabinetBtn').classList.remove('hidden');
            }

            try {
                const res = await fetch(GET_URL, { method: 'GET', headers: { 'Content-Type': 'application/json' }});
                if (!res.ok) throw new Error("Network error");
                const data = await res.json();
                allBrokers = data.brokers; allCountries = data.countries;
                
                renderSelects();
                openScreen('mainMenuScreen');
            } catch (error) {
                alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.");
            }
        }

        // 2. –û–¢–†–ò–°–û–í–ö–ê –°–ï–õ–ï–ö–¢–û–í
        function renderSelects() {
            const cSelect = document.getElementById('countrySelect');
            cSelect.innerHTML = '<option value="" selected>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>';
            allCountries.forEach(c => cSelect.innerHTML += `<option value="${c}">${c}</option>`);
        }

        function filterBrokers() {
            const selectedCountry = document.getElementById('countrySelect').value;
            const bSelect = document.getElementById('brokerSelect');
            bSelect.innerHTML = '<option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –±—Ä–æ–∫–µ—Ä–∞</option>';
            const filtered = selectedCountry ? allBrokers.filter(b => b.countries.includes(selectedCountry)) : allBrokers;
            filtered.forEach(b => bSelect.innerHTML += `<option value="${b.id}">${b.name}</option>`);
        }

        // 3. –£–ú–ù–ê–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø
        function openScreen(screenId) {
            document.getElementById(currentScreenId).classList.add('hidden');
            document.getElementById(screenId).classList.remove('hidden');
            currentScreenId = screenId;

            tg.MainButton.offClick(submitReferral);
            tg.MainButton.offClick(submitHrRequest);
            tg.MainButton.offClick(submitOnboarding);
            tg.BackButton.offClick(goBack);

            if (screenId === 'mainMenuScreen') {
                tg.BackButton.hide();
                tg.MainButton.hide();
            } else {
                tg.BackButton.show();
                tg.BackButton.onClick(goBack);

                if (screenId === 'referralFormScreen') {
                    tg.MainButton.setText("–û–¢–ü–†–ê–í–ò–¢–¨ –õ–ò–î");
                    tg.MainButton.setParams({ color: '#bba589', text_color: '#ffffff' });
                    tg.MainButton.onClick(submitReferral);
                    tg.MainButton.show();
                } else if (screenId === 'hrRequestScreen') {
                    tg.MainButton.setText("–û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£ –ù–ê –ü–û–î–ë–û–†");
                    tg.MainButton.setParams({ color: '#333333', text_color: '#ffffff' });
                    tg.MainButton.onClick(submitHrRequest);
                    tg.MainButton.show();
                } else if (screenId === 'onboardingRequestScreen') {
                    tg.MainButton.setText("–û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£ –ù–ê –û–ù–ë–û–†–î–ò–ù–ì");
                    tg.MainButton.setParams({ color: '#333333', text_color: '#ffffff' });
                    tg.MainButton.onClick(submitOnboarding);
                    tg.MainButton.show();
                } else if (screenId === 'hrCabinetScreen') {
                    tg.MainButton.hide();
                }
            }
        }

        function goBack() { openScreen('mainMenuScreen'); }

        // 4. –§–£–ù–ö–¶–ò–ò –û–¢–ü–†–ê–í–ö–ò
        async function submitReferral() {
            const brokerId = document.getElementById('brokerSelect').value;
            const clientName = document.getElementById('clientName').value;
            const clientPhone = document.getElementById('clientPhone').value;
            
            if (!brokerId || !clientName || !clientPhone) { tg.showAlert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ë—Ä–æ–∫–µ—Ä–∞, –ò–º—è –∏ –¢–µ–ª–µ—Ñ–æ–Ω!"); return; }
            tg.MainButton.showProgress();

            const payload = {
                type: 'lead_referral',
                sender_name: tg.initDataUnsafe.user?.first_name,
                sender_tg_id: tg.initDataUnsafe.user?.id,
                target_broker_id: brokerId,
                country: document.getElementById('countrySelect').value,
                client_name: clientName,
                client_phone: clientPhone,
                budget: document.getElementById('clientBudget').value,
                comment: document.getElementById('comment').value
            };

            await sendData(POST_REFERRAL_URL, payload, "‚úÖ –õ–∏–¥ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–¥–∞–Ω!");
        }

        async function submitHrRequest() {
            const title = document.getElementById('hr_v_title').value;
            if (!title) { tg.showAlert("–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏!"); return; }
            tg.MainButton.showProgress();

            const payload = {
                type: 'hr_vacancy',
                sender_name: tg.initDataUnsafe.user?.first_name,
                sender_tg_id: tg.initDataUnsafe.user?.id,
                v_title: title,
                v_dept: document.getElementById('hr_v_dept').value,
                v_manager: document.getElementById('hr_v_manager').value,
                v_reason: document.getElementById('hr_v_reason').value,
                v_date: document.getElementById('hr_v_date').value,
                v_format: document.getElementById('hr_v_format').value,
                v_trips: document.getElementById('hr_v_trips').value,
                v_employment: document.getElementById('hr_v_employment').value,
                v_salary: document.getElementById('hr_v_salary').value,
                v_duties: document.getElementById('hr_v_duties').value,
                v_reqs: document.getElementById('hr_v_reqs').value,
                v_comments: document.getElementById('hr_v_comments').value
            };

            await sendData(POST_HR_VACANCY_URL, payload, "‚úÖ –ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–¥–±–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
        }

        async function submitOnboarding() {
            const name = document.getElementById('onb_name').value;
            if (!name) { tg.showAlert("–£–∫–∞–∂–∏—Ç–µ –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞!"); return; }
            tg.MainButton.showProgress();

            const payload = {
                type: 'hr_onboarding',
                sender_name: tg.initDataUnsafe.user?.first_name,
                sender_tg_id: tg.initDataUnsafe.user?.id,
                o_name: name,
                o_position: document.getElementById('onb_position').value,
                o_country: document.getElementById('onb_country').value,
                o_start_date: document.getElementById('onb_start_date').value,
                o_contacts: document.getElementById('onb_contacts').value,
                o_workplace: document.getElementById('onb_workplace').value,
                o_email_req: document.getElementById('onb_email_req').value,
                o_sim: document.getElementById('onb_sim').value,
                o_equipment: document.getElementById('onb_equipment').value,
                o_office_extras: document.getElementById('onb_office_extras').value,
                o_gdrive: document.getElementById('onb_gdrive').value,
                o_whatsapp: document.getElementById('onb_whatsapp').value,
                o_other_access: document.getElementById('onb_other_access').value,
                o_comments: document.getElementById('onb_comments').value
            };

            await sendData(POST_ONBOARDING_URL, payload, "‚úÖ –ó–∞—è–≤–∫–∞ –Ω–∞ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
        }

        async function sendData(url, payload, successMsg) {
            try {
                const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                tg.MainButton.hideProgress();
                if (res.ok) { 
                    tg.showAlert(successMsg); 
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
                    document.querySelectorAll('input, textarea').forEach(el => el.value = '');
                    openScreen('mainMenuScreen'); 
                } 
                else { tg.showAlert("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."); }
            } catch (error) {
                tg.MainButton.hideProgress();
                tg.showAlert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏.");
            }
        }

        init();
    </script>
</body>
</html>
